# SLC AI Advisor - Cloudflare Worker Configuration
# See: https://developers.cloudflare.com/workers/wrangler/configuration/

name = "slc-ai-advisor"
compatibility_date = "2025-12-01"
compatibility_flags = ["nodejs_compat"]

# Worker entry point (API routes)
main = "./worker/index.ts"

# Static assets configuration (React SPA)
# - not_found_handling: serve index.html for SPA client-side routing
# - run_worker_first: route /api/* and /agents/* to worker before static assets
[assets]
not_found_handling = "single-page-application"
run_worker_first = ["/api/*", "/agents/*"]

# Observability
[observability]
enabled = true

# Vectorize Index for Knowledge Base
# NOTE: Create this index via CLI (see spec/slc-ai-advisor-mvp/design.md):
#   wrangler vectorize create slc-knowledge-base --dimensions 1024 --metric cosine
# Then create metadata indexes for filtering.
# Model: @cf/baai/bge-m3 (1024 dimensions, 60K token context)
[[vectorize]]
binding = "VECTORIZE"
index_name = "slc-knowledge-base"

# Durable Objects for Session State and Chat Agent
[durable_objects]
bindings = [
  { name = "USER_SESSION", class_name = "UserSession" },
  { name = "ChatAgent", class_name = "ChatAgent" }
]

[[migrations]]
tag = "v1"
new_sqlite_classes = ["UserSession"]

[[migrations]]
tag = "v2"
new_sqlite_classes = ["ChatAgent"]

# AI Binding for embeddings
[ai]
binding = "AI"

# Environment Variables (set via wrangler secret or dashboard)
# ANTHROPIC_API_KEY - Set via: wrangler secret put ANTHROPIC_API_KEY

# Development
[dev]
port = 8787
local_protocol = "http"
