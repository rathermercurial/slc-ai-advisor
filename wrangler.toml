# SLC AI Advisor - Cloudflare Worker Configuration
# See: https://developers.cloudflare.com/workers/wrangler/configuration/

name = "slc-ai-advisor"
compatibility_date = "2025-01-01"
compatibility_flags = ["nodejs_compat"]

# Worker entry point (API routes)
main = "./worker/index.ts"

# Static assets configuration (React SPA)
# - not_found_handling: serve index.html for SPA client-side routing
# - run_worker_first: route /api/* to worker before static assets
[assets]
not_found_handling = "single-page-application"
run_worker_first = ["/api/*"]

# Observability
[observability]
enabled = true

# Vectorize Index for Knowledge Base
# NOTE: Create this index manually in the Cloudflare dashboard first:
# 1. Go to Workers & Pages > Vectorize
# 2. Create index named "slc-knowledge-base"
# 3. Dimensions: 768 (for bge-base-en-v1.5)
# 4. Metric: cosine
[[vectorize]]
binding = "VECTORIZE"
index_name = "slc-knowledge-base"

# Durable Objects for Session State
[durable_objects]
bindings = [
  { name = "USER_SESSION", class_name = "UserSession" }
]

[[migrations]]
tag = "v1"
new_sqlite_classes = ["UserSession"]

# AI Binding for embeddings
[ai]
binding = "AI"

# Environment Variables (set via wrangler secret or dashboard)
# ANTHROPIC_API_KEY - Set via: wrangler secret put ANTHROPIC_API_KEY

# Development
[dev]
port = 8787
local_protocol = "http"
